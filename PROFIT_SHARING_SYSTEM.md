# Daily Profit-Sharing System for Investment Deals

## Overview

This document outlines a sophisticated daily profit-sharing system for the Sahaminvest platform, where partners create investment deals, investors contribute funds, and profits are distributed proportionally based on investment amounts and predefined partner commission structures.

## System Architecture

### Core Concept

When a partner creates a deal (e.g., selling mobile phones requiring $10,000), multiple investors can contribute different amounts. As the deal generates profits over time, these profits are distributed daily based on:

1. **Investment Proportion**: Each investor's share of the total funding
2. **Partner Commission**: Predetermined percentage for the partner
3. **Platform Fee**: Small percentage for platform operations
4. **Daily Performance**: Actual profits generated by the deal

### Example Scenario

**Deal**: Mobile Phone Trading
- **Funding Goal**: $10,000
- **Partner Commission**: 20%
- **Platform Fee**: 2%
- **Investor Share**: 78%

**Investments**:
- Investor A: $2,000 (20% of total)
- Investor B: $4,000 (40% of total)
- Investor C: $4,000 (40% of total)

**Day 4 Results**:
- **Total Value**: $12,000 (20% growth)
- **Total Profit**: $2,000
- **Partner Commission**: $400 (20% of $2,000)
- **Platform Fee**: $40 (2% of $2,000)
- **Investor Profit Pool**: $1,560 (78% of $2,000)

**Daily Profit Distribution**:
- Investor A: $312 (20% of $1,560)
- Investor B: $624 (40% of $1,560)
- Investor C: $624 (40% of $1,560)

## Database Schema Enhancements

### New Models

#### DealPerformance
```prisma
model DealPerformance {
  id                String          @id @default(cuid())
  projectId         String
  project           Project         @relation(fields: [projectId], references: [id])
  
  // Daily metrics
  date              DateTime        @db.Date
  currentValue      Decimal         @db.Decimal(15, 2)
  dailyProfit       Decimal         @db.Decimal(15, 2)
  cumulativeProfit  Decimal         @db.Decimal(15, 2)
  profitPercentage  Decimal         @db.Decimal(8, 4) // 4 decimal precision
  
  // Market factors
  marketConditions  String?         // Description of market factors
  performanceNotes  String?         @db.Text
  
  // Verification
  verifiedBy        String?
  verifiedAt        DateTime?
  verifier          User?           @relation(fields: [verifiedBy], references: [id])
  
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  @@unique([projectId, date])
  @@map("deal_performance")
}
```

#### ProfitDistribution
```prisma
model ProfitDistribution {
  id                String          @id @default(cuid())
  projectId         String
  project           Project         @relation(fields: [projectId], references: [id])
  performanceId     String
  performance       DealPerformance @relation(fields: [performanceId], references: [id])
  
  // Distribution details
  distributionDate  DateTime        @db.Date
  totalProfit       Decimal         @db.Decimal(15, 2)
  partnerCommission Decimal         @db.Decimal(15, 2)
  platformFee       Decimal         @db.Decimal(15, 2)
  investorPool      Decimal         @db.Decimal(15, 2)
  
  // Commission rates (stored for historical accuracy)
  partnerCommissionRate Decimal     @db.Decimal(5, 4) // e.g., 0.2000 for 20%
  platformFeeRate   Decimal         @db.Decimal(5, 4) // e.g., 0.0200 for 2%
  
  // Status
  status            DistributionStatus @default(PENDING)
  processedAt       DateTime?
  processedBy       String?
  processor         User?           @relation(fields: [processedBy], references: [id])
  
  // Relationships
  investorDistributions InvestorProfitShare[]
  
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  
  @@unique([projectId, distributionDate])
  @@map("profit_distributions")
}

enum DistributionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}
```

#### InvestorProfitShare
```prisma
model InvestorProfitShare {
  id                String              @id @default(cuid())
  distributionId    String
  distribution      ProfitDistribution  @relation(fields: [distributionId], references: [id])
  investmentId      String
  investment        Investment          @relation(fields: [investmentId], references: [id])
  investorId        String
  investor          User                @relation(fields: [investorId], references: [id])
  
  // Share calculation
  investmentAmount  Decimal             @db.Decimal(15, 2)
  investmentShare   Decimal             @db.Decimal(8, 6) // Precise percentage
  profitAmount      Decimal             @db.Decimal(15, 2)
  
  // Payout details
  status            PayoutStatus        @default(PENDING)
  paidAt            DateTime?
  transactionId     String?
  transaction       Transaction?        @relation(fields: [transactionId], references: [id])
  
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  
  @@unique([distributionId, investmentId])
  @@map("investor_profit_shares")
}

enum PayoutStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
  CANCELLED
}
```

### Enhanced Project Model
```prisma
model Project {
  // ... existing fields ...
  
  // Profit sharing configuration
  partnerCommissionRate Decimal?        @db.Decimal(5, 4) @default(0.2000) // 20%
  platformFeeRate       Decimal?        @db.Decimal(5, 4) @default(0.0200) // 2%
  profitCalculationMethod String?       @default("PROPORTIONAL") // PROPORTIONAL, FIXED, TIERED
  
  // Performance tracking
  currentValue          Decimal?        @db.Decimal(15, 2)
  totalProfitGenerated  Decimal         @default(0) @db.Decimal(15, 2)
  totalProfitDistributed Decimal        @default(0) @db.Decimal(15, 2)
  lastProfitUpdate      DateTime?
  
  // Relationships
  performances          DealPerformance[]
  profitDistributions   ProfitDistribution[]
}
```

### Enhanced Investment Model
```prisma
model Investment {
  // ... existing fields ...
  
  // Profit tracking
  totalProfitEarned     Decimal         @default(0) @db.Decimal(15, 2)
  lastProfitDate        DateTime?
  investmentShare       Decimal?        @db.Decimal(8, 6) // Calculated share percentage
  
  // Relationships
  profitShares          InvestorProfitShare[]
}
```

## Implementation Components

### 1. Profit Calculation Engine

#### Core Algorithm
```typescript
interface ProfitCalculation {
  projectId: string
  date: Date
  currentValue: number
  previousValue: number
  dailyProfit: number
  partnerCommission: number
  platformFee: number
  investorPool: number
  investorShares: InvestorShare[]
}

interface InvestorShare {
  investorId: string
  investmentId: string
  investmentAmount: number
  sharePercentage: number
  profitAmount: number
}

class ProfitCalculationEngine {
  async calculateDailyProfits(projectId: string, date: Date): Promise<ProfitCalculation> {
    // 1. Get project and current performance data
    // 2. Calculate daily profit/loss
    // 3. Apply commission and fee structure
    // 4. Distribute remaining profit proportionally
    // 5. Create distribution records
  }
}
```

### 2. Daily Profit Tracking System

#### Automated Daily Processing
```typescript
class DailyProfitProcessor {
  async processDailyProfits() {
    const activeDeals = await this.getActiveDeals()
    
    for (const deal of activeDeals) {
      try {
        // Get current market value/performance
        const currentValue = await this.getCurrentDealValue(deal.id)
        
        // Calculate profits
        const profitCalc = await this.calculateProfits(deal, currentValue)
        
        // Create performance record
        await this.recordDealPerformance(profitCalc)
        
        // Distribute profits
        await this.distributeProfits(profitCalc)
        
        // Update investor balances
        await this.updateInvestorBalances(profitCalc)
        
        // Send notifications
        await this.sendProfitNotifications(profitCalc)
        
      } catch (error) {
        console.error(`Failed to process profits for deal ${deal.id}:`, error)
      }
    }
  }
}
```

### 3. Dashboard Integration

#### Investor Portfolio Updates
- **Daily Profit Tracking**: Real-time profit updates for each investment
- **Performance Charts**: Visual representation of investment growth
- **Profit History**: Detailed history of daily profit distributions
- **Projected Returns**: AI-powered projections based on current performance

#### Partner Dashboard Enhancements
- **Deal Performance Metrics**: Real-time tracking of deal profitability
- **Commission Tracking**: Daily commission earnings from deals
- **Investor Analytics**: Insights into investor behavior and preferences
- **Market Performance**: Comparison with market benchmarks

#### Admin Monitoring Tools
- **System Overview**: Platform-wide profit distribution metrics
- **Deal Monitoring**: Real-time monitoring of all active deals
- **Anomaly Detection**: Automated alerts for unusual profit patterns
- **Audit Trails**: Complete audit trail of all profit calculations

### 4. Financial Officer Tools

#### Profit Distribution Management
- **Manual Overrides**: Ability to manually adjust profit calculations
- **Batch Processing**: Bulk processing of profit distributions
- **Reconciliation Tools**: Tools to reconcile calculated vs actual profits
- **Reporting Dashboard**: Comprehensive financial reporting

## API Endpoints

### Deal Performance APIs
```typescript
// Record daily performance
POST /api/deals/{id}/performance
{
  "date": "2024-01-20",
  "currentValue": 12000,
  "marketConditions": "Favorable market conditions",
  "performanceNotes": "Strong sales performance"
}

// Get deal performance history
GET /api/deals/{id}/performance?startDate=2024-01-01&endDate=2024-01-31

// Get investor profit history
GET /api/investments/{id}/profits?period=30days
```

### Profit Distribution APIs
```typescript
// Trigger profit calculation
POST /api/deals/{id}/calculate-profits
{
  "date": "2024-01-20",
  "currentValue": 12000
}

// Get profit distribution details
GET /api/deals/{id}/distributions/{distributionId}

// Process pending distributions
POST /api/admin/process-distributions
{
  "distributionIds": ["dist_123", "dist_124"]
}
```

## User Experience Enhancements

### Real-time Notifications
- **Daily Profit Updates**: Automatic notifications when profits are calculated
- **Performance Milestones**: Alerts when deals reach performance milestones
- **Distribution Confirmations**: Confirmations when profits are distributed to wallets

### Mobile-First Design
- **Profit Widgets**: Quick-view widgets showing daily profit changes
- **Performance Charts**: Mobile-optimized charts and graphs
- **Investment Tracking**: Easy-to-use investment tracking interface

### Transparency Features
- **Calculation Transparency**: Detailed breakdown of profit calculations
- **Performance Attribution**: Clear attribution of profits to market factors
- **Historical Data**: Complete historical data for all investments

## Risk Management

### Automated Safeguards
- **Profit Validation**: Automated validation of profit calculations
- **Anomaly Detection**: Detection of unusual profit patterns
- **Circuit Breakers**: Automatic halt of distributions if anomalies detected

### Manual Oversight
- **Financial Officer Review**: Manual review of large profit distributions
- **Partner Verification**: Partner verification of deal performance data
- **Investor Dispute Resolution**: Process for handling profit disputes

## Security Considerations

### Data Protection
- **Encryption**: All financial data encrypted at rest and in transit
- **Access Controls**: Role-based access controls for sensitive operations
- **Audit Logging**: Comprehensive audit logging of all profit-related operations

### Fraud Prevention
- **Multi-factor Authentication**: MFA required for profit distribution operations
- **Transaction Monitoring**: Real-time monitoring of suspicious activities
- **Regular Audits**: Regular audits of profit calculation algorithms

## Performance Optimization

### Database Optimization
- **Indexing Strategy**: Optimized indexes for profit calculation queries
- **Data Partitioning**: Partitioning of large profit history tables
- **Caching Layer**: Redis caching for frequently accessed profit data

### Scalability Considerations
- **Microservices Architecture**: Separation of profit calculation into microservices
- **Queue-based Processing**: Asynchronous processing of profit distributions
- **Load Balancing**: Load balancing for high-volume profit calculations

## Implementation Roadmap

### Phase 1: Foundation (Weeks 1-2)
- [ ] Database schema implementation
- [ ] Basic profit calculation engine
- [ ] Core API endpoints

### Phase 2: Dashboard Integration (Weeks 3-4)
- [ ] Investor dashboard updates
- [ ] Partner dashboard enhancements
- [ ] Basic reporting tools

### Phase 3: Advanced Features (Weeks 5-6)
- [ ] Automated daily processing
- [ ] Advanced analytics
- [ ] Mobile optimization

### Phase 4: Production Deployment (Weeks 7-8)
- [ ] Security hardening
- [ ] Performance optimization
- [ ] User acceptance testing
- [ ] Production deployment

## Success Metrics

### Business Metrics
- **Investor Satisfaction**: Measured through surveys and retention rates
- **Partner Adoption**: Number of partners actively using the system
- **Transaction Volume**: Total value of investments processed daily

### Technical Metrics
- **System Reliability**: 99.9% uptime for profit calculation services
- **Processing Speed**: Sub-second profit calculation for standard deals
- **Data Accuracy**: 100% accuracy in profit calculations (verified through audits)

## Conclusion

This sophisticated daily profit-sharing system will transform the Sahaminvest platform into a transparent, efficient, and user-friendly investment platform. By providing real-time profit tracking, proportional distribution, and comprehensive reporting, the system will enhance trust and engagement among all stakeholders.

The implementation follows best practices for financial systems, including robust security measures, comprehensive audit trails, and scalable architecture. The phased rollout approach ensures minimal disruption to existing operations while delivering incremental value to users.

---

*This document serves as the technical specification for implementing the daily profit-sharing system. It should be reviewed and approved by all stakeholders before implementation begins.*



